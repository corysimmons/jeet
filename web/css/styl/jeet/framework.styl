@import 'nib'

/*  Syntax quick reference
 *  ----------------------
 *  gutter[gut, g] = 1
 *  cf() - clearfix
 *  center(max_width = 1410px)
 *  column[col](ratios = 1, offset = false, g = gutter)
 *  span(ratio = 1, offset = false)
 *  shift(ratios = 0, g = gutter)
 *  unshift()
 *  getSpan(ratio)
 *  getColumn(ratios = 1, g = gutter, nested = false)
 *  bp(w = 705px, mobile_first = false[mf])
 *  endbp()
 *  stack(align = center[c, left, l, right, r])
 *  edit()
 *  pxfix()
 */


gutter = 2
parent_first = false
layout_direction = LTR

center(max_width = 1410px)
    @extends $clearfix
    @extends $centerbase
    max-width max_width

container(ratios = null, g = gutter)
    @extends $containerbase
    side = getLayoutDirection()
    if ratios != null
        margin = getGutter(ratios, g)
        margin_inside = getColumn(1 ratios, g)[1]
    else
        margin = g
        margin_inside = getColumn(1, g)[1]
    margin-{side} (-(margin))%
    &:before
        {side} (margin_inside)%

column(ratios = 1, offset = 0, g = gutter, cont = false)
    // Gather Information
    side = getLayoutDirection()
    if cont is false
        widths = getColumn(ratios, g)
        width = widths[0]
        margin = widths[1]
    else
        width = ratios[0] * 100
        margin = 0
    // Calculate Offset
    unless offset == 0
        if offset < 0
            offset *= -1
            margin_opp = offset * 100
            margin-{opposite-position(side)} (margin_opp)%
        else
            offset = offset * 100
            margin = offset + margin
    // Mixin
    @extends $clearfix
    float side
    width (width)%
    margin-{side} (margin)%

span(ratio = 1, offset = 0)
    // Gather Information
    side = getLayoutDirection()
    width = getSpan(ratio)
    margin_l = margin_r = 0
    // Calculate Offset
    unless offset == 0
        if offset < 0
            offset *= -1
            margin_r = getSpan(offset)
        else
            margin_l = getSpan(offset)
    // Mixin
    @extends $clearfix
    float side
    width (width)%
    margin-{side} (margin_l)%
    margin-{opposite-position(side)} (margin_r)%

shift(ratios = 0, g = gutter, type = col)
    // Get direction information
    side = getLayoutDirection()
    if side == right
        ratios = replace-nth(ratios, 0, ratios[0] * -1)
    if type == column or type == col or type == c
        widths = getColumn(ratios, g)
        translate = widths[0] + widths[1]
    else
        translate = getSpan(ratios)
    // Shift
    position relative
    left (translate)%

unshift()
    position static
    left 0

cycle(columns = 1)
    side = getLayoutDirection()
    &:nth-child({columns}n)
        float opposite-position(side)

uncycle(columns = 1)
    side = getLayoutDirection()
    &:nth-child({columns}n)
        float side

getColumn(ratios = 1, g = gutter)
    // Returns the width and gutter for a column
    ratios = reverse(ratios) unless parent_first is true
    w = 100
    for ratio in ratios
        g = g / (w + g) * 100
        w = 100 * ratio - g
    return w g

getGutter(ratios = 1, g = gutter)
    // Returns the gutter for a container
    ratios = reverse(ratios) unless parent_first is true
    for ratio in ratios
        w = 100 * ratio - g
        g = g / (w + g) * 100
    return g

getSpan(ratio = 1)
    // Returns the width of a span
    return ratio * 100

getLayoutDirection()
    layout_direction == RTL ? result = right : result = left
    return result

bp(w = 705px, mobile_first = false)
    if (mobile_first == mf || mobile_first == true)
        unquote("@media all and (min-width: " + w + ") {")
    else
        unquote("@media all and (max-width: " + w + ") {")
endbp()
    unquote("}")

stack(align = center)
    display block
    width 100%
    margin-left auto
    margin-right auto
    margin-bottom (g * 3)%
    if (align == center) or (align == c)
        text-align center
    if (align == l) or (align == l)
        text-align left
    if (align == r) or (align == r)
        text-align right

edit()
    body *
        transition 200ms ease all
        background rgba(#000, .15)

pxfix() // http://stackoverflow.com/a/12371926/1242079
    float none
    overflow hidden
    width auto

// List functions
replace-nth(list, index, value)
    result = ()
    index = length(list) + index if index < 0
    for i in (0..(length(list) - 1))
        if i == index
            append(result, value)
        else
            append(result, list[i])
    return result

remove-nth(list, index)
    result = ()
    index = length(list) + index if index < 0  
    for i in (0..(length(list) - 1))
        if i != index 
            append(result, list[i])
    return result

reverse(list)
    result = ()
    for item in list
        prepend(result, item)
    return result

// Function aliases
g = gutter
gut = gutter
col = column
off = offset
cf = clearfix

// Placeholder selectors
$clearfix
    cf()

$centerbase
    float none
    display block
    margin-right auto
    margin-left auto
    *margin-right auto
    *margin-left auto

$containerbase
    display block
    overflow hidden
    position relative
    &:before
        content: ''
        width: 100%
        height: 100%
        position: absolute
        top: 0
        z-index: -1


// Config junk
*
    box-sizing(border-box)
    *behavior url(js/vendor/boxsizing.htc)
html
    overflow-y scroll
    overflow-x hidden
body
    @extends $clearfix
    width 100%
img, video, audio, embed, object, input, iframe
    max-width 100%
.placeholder
    color #aaa
